# Base system to see other players

- [Base system to see other players](#base-system-to-see-other-players)
  - [Lobby connection](#lobby-connection)
  - [Sending and receiving data](#sending-and-receiving-data)
  - [Lobby disconnection](#lobby-disconnection)
  - [Connection data](#connection-data)
  


The base system to see other players is controlled by the [LobbyNetworkingController.cs](/SacredTailsDocumentation/SacredTailsDocumentation/api/Timba.Games.SacredTails.LobbyNetworking.LobbyNetworkingController.html) class. This class can be accessed from the [ServiceLocator]() with the interface [ILobbyNetworkManager.cs](/SacredTailsDocumentation/SacredTailsDocumentation/api/Timba.Games.SacredTails.LobbyNetworking.ILobbyNetworkManager.html) and is in charge of 3 functionalities: connect to the lobby, send/receive data from the players and disconnect the player.

## Lobby connection

The connection to the lobby is done from the [ConnectToLobby](/SacredTailsDocumentation/SacredTailsDocumentation/api/Timba.Games.SacredTails.LobbyNetworking.LobbyNetworkingController.html#Timba_Games_SacredTails_LobbyNetworking_LobbyNetworkingController_ConnectToLobby_System_Int32_) which needs the lobby index and the [connection data](#connection-data) and then playfab is in charge of sending who is entering to the azure server with this data. It also receives a **Connection ID** in the **Cloud Script** response, which is used to detect if the current connection is the most recent one.

## Sending and receiving data

The sending and receiving of data is done every X seconds in the function [TickCheck()](/SacredTailsDocumentation/SacredTailsDocumentation/api/Timba.Games.SacredTails.LobbyNetworking.LobbyNetworkingController.html#Timba_Games_SacredTails_LobbyNetworking_LobbyNetworkingController_TickCheck). This method is in charge of sending the [connection-data](#connection-data) of the user and process locally those of the other users. Here we do things like instantiate new players, handle disconnection for not moving for a certain period of time, format the character style, display messages to the user with their respective tags and receive/send challenges from/to other players.

## Lobby disconnection

When exiting the application, in an OnApplicationQuit, a call is made to perform the disconnection on the server. This request only needs the lobby index, then the playfab call send this lobby index with the players id so it can disconnect it from the game.  

## Connection data

The data used in the lobby system are the following:

|Name |Type |Description|
|-----|-----|--------|
|**connectionId**|uint |Id of connection to the lobby, this id is generated when the connection is made and is checked to see if the connection has not been opened in another instance. If this is the case, the old instance is closed.|
|**displayName**  |string |Nickname of the user|
|**playerPosition**  |{x:float, y:float, z:float} | x,y,z position of the users in the game.|
|**chatMessages** |{message:string,timesStamp:string,id:int} |User's chat message arrangements. |
|**shinseiCompanionDna** |string |Dna of the company shinsei, to show it in the game |
|**characterStyle** |string |Players character style code. |
|**characterState** |int |Player's state (backpack, combat, lobby, etc). |
|**currentMatchId** |string |If in a match, it is the id of the current match, otherwise is empty. |
|**challengedPlayer**|string |Id that identifies if the player has challenged someone, or cancelled a challenge. |